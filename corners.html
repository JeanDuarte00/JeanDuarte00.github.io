<!DOCTYPE html>
<html><head>
        <meta charset="utf-8">
        <title>Image Canny Example</title>
        <link href="js_example_style.css" rel="stylesheet" type="text/css">
        <script async src="opencv.js" onload="onOpenCvReady()" type="text/javascript"></script>
        <script src="chrome-extension://mooikfkahbdckldjjndioackbalphokd/assets/prompt.js"></script></head>
        <body>
        <h2>Image Canny Example</h2>
        <p>
            &lt;canvas&gt; elements named <b>canvasInput</b> and <b>canvasOutput</b> have been prepared.<br>
            Click <b>Try it</b> button to see the result. You can choose another image.<br>
            You can change the code in the &lt;textarea&gt; to investigate more.
        </p>
        <div>
        <div class="control"><button id="tryIt">Try it</button></div>
        <textarea class="code" rows="9" cols="100" id="codeEditor" spellcheck="false"></textarea>
        <p class="err" id="errorMessage"></p>
        </div>
        <div>
            <table cellpadding="0" cellspacing="0" width="0" border="0">
            <tbody><tr>
                <td>
                    <canvas id="canvasInput" width="128" height="128"></canvas>
                </td>
                <td>
                    <canvas id="canvasOutput" width="128" height="128"></canvas>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="caption">canvasInput <input type="file" id="fileInput" name="file" accept="image/*"></div>
                </td>
                <td>
                    <div class="caption">canvasOutput</div>
                </td>
            </tr>
            </tbody></table>
        </div>
        <script async="" type="text/javascript" src="opencv.js"></script><script src="utils.js" type="text/javascript"></script>
        <script id="codeSnippet" type="text/code-snippet">
        let src = cv.imread('canvasInput');
        let dst = new cv.Mat();
        cv.cvtColor(src, src, cv.COLOR_RGB2GRAY, 0);
        // You can try more different parameters
        cv.Canny(src, dst, 50, 100, 3, false);
        cv.imshow('canvasOutput', dst);
        src.delete(); dst.delete();
        </script>
        <script type="text/javascript">
        let utils = new Utils('errorMessage');
        
        utils.loadCode('codeSnippet', 'codeEditor');
        utils.loadImageToCanvas('lena.jpg', 'canvasInput');
        utils.addFileInputHandler('fileInput', 'canvasInput');
        
        let tryIt = document.getElementById('tryIt');
        tryIt.addEventListener('click', () => {
            utils.executeCode('codeEditor');
        });
        
        utils.loadOpenCv(() => {
            tryIt.removeAttribute('disabled');
        });
        </script>
        
        
        </body></html>

<!--

<html lang="en">

  <head>
      <meta name="mobile-web-app-capable" content="yes">
    <meta charset="UTF-8">
    <title>MiniGame</title>
    <link rel="stylesheet" href="track.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


    <script>
    
    function colorDistance(r1,g1,b1,r2,g2,b2){
        var dr = r1 - r2;
        var dg = g1 - g2;
        var db = b1 - b2;
        return Math.sqrt( dr*dr + dg*dg + db*db );
    }

    function sumDistance(imageData,x,y,n){
        var pixels = imageData.data,
            imageSizeX = imageData.width,
            imageSizeY = imageData.height;

        // position information
        var px, py, i, j, pos;
        
        // distance accumulator
        var dSum = 0;
        
        // colors
        var r1 = pixels[4*(imageSizeX*y+x) + 0];
        var g1 = pixels[4*(imageSizeX*y+x) + 1];
        var b1 = pixels[4*(imageSizeX*y+x) + 2];
        var r2, g2, b2;
        
        for( i=-n; i<=n; i+=1 ){
            for( j=-n; j<=n; j+=1 ){

                // Tile the image if we are at an end
                px = (x+i) % imageSizeX;
                px = (px>0)?px:-px;
                py = (y+j) % imageSizeY;
                py = (py>0)?py:-py;

                // Get the colors of this pixel
                pos = 4*(imageSizeX*py + px);
                r2 = pixels[pos+0];
                g2 = pixels[pos+1];
                b2 = pixels[pos+2];

                // Work with the pixel
                dSum += colorDistance(r1,g1,b1,r2,g2,b2);
            }
        }

        return dSum;
    }

    function computeDistanceData(imageData,n){
        var pixels = imageData.data,
            imageSizeX = imageData.width,
            imageSizeY = imageData.height;

        var x,y;
        var data = [];
        for( x=0; x<imageSizeX; x+=1 ){
            for( y=0; y<imageSizeY; y+=1 ){
                data.push( {
                    x: x,
                    y: y,
                    d: sumDistance(imageData,x,y,n)
                } );
            }
        }

        return data;
    }


    function byDecreasingD(a,b){
        return b.d - a.d;
    }



    function findCorners(canvas,apertureSize,numPoints){
        // Get the raw pixel data from the canvas
        var context = canvas.getContext('2d');
        var imageData = context.getImageData(0,0,canvas.width,canvas.height);

        // Compute and return the results
        var results = computeDistanceData(imageData,apertureSize);  
        return results.sort(byDecreasingD).slice(0,numPoints); 
    }
    
    </script>

  </head>

  <body>

  </body>

</html> -->